<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4 PLAY CHESS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #1e1e1e;
            color: #fff;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 30px;
            padding: 15px;
            background-color: #111;
            border-radius: 10px;
        }

        .section h2 {
            margin-top: 0;
            text-align: center;
            color: #fff;
        }

        /* Chess Game Styles */
        #game-grid {
            display: grid;
            grid-template-columns: repeat(16, 20px);
            grid-gap: 2px;
            margin: 20px auto;
            justify-content: center;
        }

        .tile {
            width: 20px;
            height: 20px;
            background-color: #777;
            border: 1px solid #1e1e1e;
            text-align: center;
            cursor: pointer;
            font-size: 12px;
            color: black;
            position: relative;
        }

        .tile.inactive-tile {
            background-color: #1e1e1e;
            border: 1px solid #1e1e1e;
            cursor: not-allowed;
        }

        .tile.checkered {
            background-color: #333;
        }

        .piece {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 18px;
            height: 18px;
            transform: translate(-50%, -50%);
            z-index: 1;
        }

        .tile:hover:not(.inactive-tile) {
            background-color: #16665b;
        }

        .tile img {
            max-width: 18px;
            max-height: 18px;
            vertical-align: middle;
        }

        .tile.highlighted {
            background-color: #16665b;
        }

        /* Scoreboard Styles */
        #scoreboard {
            margin: 20px auto;
            width: 200px;
            background-color: #222;
            padding: 10px;
            border-radius: 8px;
            box-sizing: border-box;
        }

        #score-table {
            width: 100%;
            border-collapse: collapse;
            color: #fff;
        }

        #score-table td {
            padding: 5px;
            font-size: 14px;
            text-align: center;
            border: 1px solid #333;
        }

        #score-table td:first-child {
            font-weight: bold;
            text-align: left;
        }

        /* Registration Form Styles */
        .form-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            background-color: #ddd;
            color: #555;
            font-size: 16px;
            box-sizing: border-box;
        }

        .form-button {
            background-color: #333;
            margin: 20px 0;
            color: #fff;
            padding: 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            text-align: center;
        }

        .form-button:hover {
            background-color: #444;
        }

        .checkboxes {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            background-color: #222;
            padding: 15px;
            border-radius: 10px;
        }

        .checkbox-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .checkbox-item label {
            margin-bottom: 5px;
            font-size: 14px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        .footer {
            background-color: #222;
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 20px;
            padding: 15px 0;
            border-radius: 10px;
        }

        .footer a {
            color: #fff;
            text-decoration: none;
            font-size: 12px;
        }

        .portal-links {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .portal-links button {
            background-color: #333;
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 12px;
        }

        .portal-links button:hover {
            background-color: #444;
        }

        .portal-links button img {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }
    </style>
</head>
<body>

    <!-- Chess Game Section -->
    <div class="section">
        <h2>4 PLAY CHESS</h2>
        <div id="game-grid">
            <!-- Game grid will be generated here -->
        </div>
        
        <!-- Scoreboard -->
        <div id="scoreboard">
            <table id="score-table">
                <tbody>
                    <tr>
                        <td>Next</td>
                        <td id="next-player-value">Gold</td>
                    </tr>
                    <tr>
                        <td>Gold</td>
                        <td id="score-gold">0</td>
                    </tr>
                    <tr>
                        <td>Green</td>
                        <td id="score-green">0</td>
                    </tr>
                    <tr>
                        <td>Red</td>
                        <td id="score-red">0</td>
                    </tr>
                    <tr>
                        <td>Black</td>
                        <td id="score-black">0</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Registration Section -->
    <div class="section">
        <h2>REGISTER FOR A NEW GAME</h2>
        
        <form>
            <input type="text" class="form-input" placeholder="YOUR AVATAR NAME" required>
            
            <h3>CHALLENGE</h3>
            <div class="checkboxes">
                <div class="checkbox-item">
                    <label for="option1">SELF</label>
                    <input type="checkbox" id="option1" name="option1">
                </div>
                <div class="checkbox-item">
                    <label for="option2">AI</label>
                    <input type="checkbox" id="option2" name="option2">
                </div>
                <div class="checkbox-item">
                    <label for="option3">OTHERS</label>
                    <input type="checkbox" id="option3" name="option3">
                </div>
            </div>
            
            <input type="text" class="form-input" placeholder="TAGLINE: READY FOR WAR" required>
            <button type="submit" class="form-button">NEXT</button>
        </form>
    </div>

    <!-- Portal Links Section -->
    <div class="section">
        <h2>PORTALS</h2>
        <div class="portal-links">
            <button onclick="window.parent.location.href='../dashboard.html'">
                <img src="../assets/portal_icon.png" alt="portal">PORTALS
            </button>
            <button onclick="window.parent.location.href='../DESTINY/opening.html'">
                <img src="../assets/fave_icon.png" alt="destiny">DESTINY
            </button>
            <button onclick="window.parent.location.href='../KTGMUSIC/mobile_ktgmusic.html'">
                <img src="../assets/music_qr_link_icon.png" alt="music">KTG.MUSIC
            </button>
            <button onclick="window.parent.location.href='../KTGAI/mobile_ktgai.html'">
                <img src="../assets/ai_brain_logo_icon.png" alt="ai">KTG.AI
            </button>
            <button onclick="window.parent.location.href='../MERCH/mobile_ktgmerch.html'">
                <img src="../assets/merch_icon.png" alt="merch">MERCH
            </button>
            <button onclick="window.parent.location.href='../WEB3/mobile_dashboard_web3.html'">
                <img src="../assets/kgz_white_icon.png" alt="web3">WEB3
            </button>
            <button onclick="window.parent.location.href='../LIFESTYLES/listingsconsole.html'">
                <img src="../assets/listing_icon.png" alt="listings">LISTINGS
            </button>
            <button onclick="window.parent.location.href='../VRARXR/mobile_dashboard_xr.html'">
                <img src="../assets/vr_icon.png" alt="xr">VR/AR/XR
            </button>
            <button onclick="window.parent.location.href='../METAPHYSICS/tarot/'">
                <img src="../assets/tarot_icon.png" alt="tarot">METAPHYSICS
            </button>
            <button onclick="window.parent.location.href='../DIGNBLING/mobile_dashboard_dign_bling.html'">
                <img src="../assets/diamond_mine_icon.png" alt="diamond">DIGN BLING
            </button>
            <button onclick="window.parent.location.href='../KTGTV/dashboard.html'">
                <img src="../assets/ktgtv_icon.png" alt="ktgtv">KTG.TV
            </button>
            <button onclick="window.parent.location.href='../MEMDAO/dashboard.html'">
                <img src="../assets/dao_icon.png" alt="memdao">MEM.DAO
            </button>
            <button onclick="window.parent.location.href='../LIFESTYLES/dashboard.html'">
                <img src="../assets/group_icon.png" alt="lifestyles">LIFESTYLES
            </button>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <a href="#">TERMS OF SERVICE</a>
        <a href="#">PRIVACY POLICY</a>
        <a href="#">RULES OF THE GAME</a>
    </div>

    <script>
// The board array now uses your custom piece layout while marking the corners as inactive.
let board = [
    [{type:'inactive'},{type:'inactive'},{type:'inactive'},{type:'inactive'}, { type: 'rook', color: 'gold' }, null, null, { type: 'king', color: 'gold' }, { type: 'queen', color: 'gold' }, null, null, { type: 'rook', color: 'gold' }, {type:'inactive'},{type:'inactive'},{type:'inactive'},{type:'inactive'}],
    [{type:'inactive'},{type:'inactive'},{type:'inactive'},{type:'inactive'}, { type: 'pawn', color: 'gold' }, null, null, { type: 'bishop', color: 'gold' }, { type: 'bishop', color: 'gold' }, null, null, { type: 'pawn', color: 'gold' }, {type:'inactive'},{type:'inactive'},{type:'inactive'},{type:'inactive'}],
    [{type:'inactive'},{type:'inactive'}, null, null, null, { type: 'pawn', color: 'gold' }, { type: 'knight', color: 'gold' }, null, null, { type: 'knight', color: 'gold' }, { type: 'pawn', color: 'gold' }, null, null, null,{type:'inactive'},{type:'inactive'}],
    [{type:'inactive'},{type:'inactive'}, null, null, null, null, { type: 'pawn', color: 'gold' }, null, null, { type: 'pawn', color: 'gold' }, null, null, null, null,{type:'inactive'},{type:'inactive'}],
    [{ type: 'rook', color: 'black' }, { type: 'pawn', color: 'black' }, null, null, null, null, null, { type: 'pawn', color: 'gold' }, { type: 'pawn', color: 'gold' }, null, null, null, null, null, { type: 'pawn', color: 'green' }, { type: 'rook', color: 'green' }],
    [null, null, { type: 'pawn', color: 'black' }, null, null, null, null, null, null, null, null, null, null, { type: 'pawn', color: 'green' }, null, null],
    [null, null, { type: 'knight', color: 'black' }, { type: 'pawn', color: 'black' }, null, null, null, null, null, null, null, null, { type: 'pawn', color: 'green' }, { type: 'knight', color: 'green' }, null, null],
    [{ type: 'king', color: 'black' }, { type: 'bishop', color: 'black' }, null, null, { type: 'pawn', color: 'black' }, null, null, null, null, null, null, { type: 'pawn', color: 'green' }, null, null, { type: 'bishop', color: 'green' }, { type: 'king', color: 'green' }],
    [{ type: 'queen', color: 'black' }, { type: 'bishop', color: 'black' }, null, null, { type: 'pawn', color: 'black' }, null, null, null, null, null, null, { type: 'pawn', color: 'green' }, null, null, { type: 'bishop', color: 'green' }, { type: 'queen', color: 'green' }],
    [null, null, { type: 'knight', color: 'black' }, { type: 'pawn', color: 'black' }, null, null, null, null, null, null, null, null, { type: 'pawn', color: 'green' }, { type: 'knight', color: 'green' }, null, null],
    [null, null, { type: 'pawn', color: 'black' }, null, null, null, null, null, null, null, null, null, null, { type: 'pawn', color: 'green' }, null, null],
    [{ type: 'rook', color: 'black' }, { type: 'pawn', color: 'black' }, null, null, null, null, null, { type: 'pawn', color: 'red' }, { type: 'pawn', color: 'red' }, null, null, null, null, null, { type: 'pawn', color: 'green' }, { type: 'rook', color: 'green' }],
    [{type:'inactive'},{type:'inactive'}, null, null, null, null, { type: 'pawn', color: 'red' }, null, null, { type: 'pawn', color: 'red' }, null, null,  null, null,{type:'inactive'},{type:'inactive'}],
    [{type:'inactive'},{type:'inactive'}, null, null, null, { type: 'pawn', color: 'red' }, { type: 'knight', color: 'red' }, null, null, { type: 'knight', color: 'red' }, { type: 'pawn', color: 'red' }, null, null, null,{type:'inactive'},{type:'inactive'}],
    [{type:'inactive'},{type:'inactive'},{type:'inactive'},{type:'inactive'}, { type: 'pawn', color: 'red' }, null, null, { type: 'bishop', color: 'red' }, { type: 'bishop', color: 'red' }, null, null, { type: 'pawn', color: 'red' }, {type:'inactive'},{type:'inactive'},{type:'inactive'},{type:'inactive'}],
    [{type:'inactive'},{type:'inactive'},{type:'inactive'},{type:'inactive'}, { type: 'rook', color: 'red' }, null, null, { type: 'king', color: 'red' }, { type: 'queen', color: 'red' }, null, null, { type: 'rook', color: 'red' }, {type:'inactive'},{type:'inactive'},{type:'inactive'},{type:'inactive'}]
];

// --- Scoring Logic ---
const pieceValues = {
    pawn: 1,
    rook: 10,
    knight: 10,
    bishop: 10,
    queen: 50,
    king: 100
};

let scores = {
    gold: 0,
    green: 0,
    red: 0,
    black: 0
};

let selectedSquare = null;
let currentPlayer = 'gold';
let turnCounter = 0;

function handleClick(x, y) {
    const cell = board[y][x];
    if (cell && cell.type === 'inactive') {
        return;
    }

    const clickedPiece = cell;

    if (selectedSquare) {
        const validMoves = getValidMoves(selectedSquare.x, selectedSquare.y);
        const isValid = validMoves.some(pos => pos.x === x && pos.y === y);

        if (isValid) {
            const targetPiece = board[y][x];
            if (targetPiece && targetPiece.type in pieceValues) {
                scores[currentPlayer] += pieceValues[targetPiece.type];
            }

            board[y][x] = board[selectedSquare.y][selectedSquare.x];
            board[selectedSquare.y][selectedSquare.x] = null;

            turnCounter++;
            currentPlayer = getNextPlayer();
            
            updateScoreboard();
        }

        selectedSquare = null;
        renderBoard();
    } else if (clickedPiece && clickedPiece.color === currentPlayer) {
        selectedSquare = { x, y };
        highlightMoves(getValidMoves(x, y));
    }
}

function getNextPlayer() {
    const players = ['gold', 'green', 'red', 'black'];
    return players[turnCounter % 4];
}

function getValidMoves(x, y) {
  const piece = board[y][x];
  if (!piece || piece.type === 'inactive') return [];

  switch (piece.type) {
    case 'pawn': return getPawnMoves(x, y, piece.color);
    case 'rook': return getLinearMoves(x, y, [[1,0],[0,1],[-1,0],[0,-1]], piece.color);
    case 'bishop': return getLinearMoves(x, y, [[1,1],[1,-1],[-1,1],[-1,-1]], piece.color);
    case 'queen': return getLinearMoves(x, y, [[1,0],[0,1],[-1,0],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]], piece.color);
    case 'knight': return getKnightMoves(x, y, piece.color);
    case 'king': return getKingMoves(x, y, piece.color);
    default: return [];
  }
}

function getPawnMoves(x, y, color) {
    const moves = [];
    let dir = [0, 0];

    switch(color) {
        case 'gold': dir = [0, 1]; break;
        case 'red': dir = [0, -1]; break;
        case 'green': dir = [-1, 0]; break;
        case 'black': dir = [1, 0]; break;
    }
    
    let newX = x + dir[0];
    let newY = y + dir[1];
    if (isEmpty(newX, newY)) {
        moves.push({ x: newX, y: newY });
    }

    const isAtStart = (color === 'gold' && y === 1) || (color === 'red' && y === 14) || (color === 'black' && x === 1) || (color === 'green' && x === 14);
    if(isAtStart && isEmpty(newX, newY)) {
        let doubleX = x + dir[0] * 2;
        let doubleY = y + dir[1] * 2;
        if(isEmpty(doubleX, doubleY)) {
            moves.push({x: doubleX, y: doubleY});
        }
    }

    let captureDirs = [];
    if (color === 'gold') captureDirs = [[1, 1], [-1, 1]];
    else if (color === 'red') captureDirs = [[1, -1], [-1, -1]];
    else if (color === 'black') captureDirs = [[1, 1], [1, -1]];
    else if (color === 'green') captureDirs = [[-1, 1], [-1, -1]];
    
    for (const [cdx, cdy] of captureDirs) {
        let captureX = x + cdx;
        let captureY = y + cdy;
        if (isEnemyPiece(captureX, captureY, color)) {
             moves.push({ x: captureX, y: captureY });
        }
    }

    return moves;
}

function getLinearMoves(x, y, directions, color) {
  let moves = [];
  directions.forEach(([dx, dy]) => {
    let cx = x + dx, cy = y + dy;
    while (isInBounds(cx, cy)) {
      const cell = board[cy][cx];
      if (cell && cell.type === 'inactive') break;
      if (!cell) {
        moves.push({ x: cx, y: cy });
      } else {
        if (cell.color !== color) moves.push({ x: cx, y: cy });
        break;
      }
      cx += dx; cy += dy;
    }
  });
  return moves;
}

function getKnightMoves(x, y, color) {
  const deltas = [[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]];
  return deltas.map(([dx, dy]) => ({ x: x+dx, y: y+dy }))
    .filter(p => isInBounds(p.x, p.y) && (!board[p.y][p.x] || (board[p.y][p.x].color !== color && board[p.y][p.x].type !== 'inactive')));
}

function getKingMoves(x, y, color) {
  const deltas = [[1,0],[0,1],[-1,0],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];
  return deltas.map(([dx, dy]) => ({ x: x+dx, y: y+dy }))
    .filter(p => isInBounds(p.x, p.y) && (!board[p.y][p.x] || (board[p.y][p.x].color !== color && board[p.y][p.x].type !== 'inactive')));
}

function isInBounds(x, y) {
  return x >= 0 && y >= 0 && x < 16 && y < 16;
}

function isEmpty(x, y) {
  return isInBounds(x, y) && !board[y][x];
}

function isEnemyPiece(x, y, color) {
  return isInBounds(x, y) && board[y][x] && board[y][x].color !== color && board[y][x].type !== 'inactive';
}

function highlightMoves(moves) {
    document.querySelectorAll('.tile.highlighted').forEach(tile => {
        tile.classList.remove('highlighted');
    });
    moves.forEach(move => {
        const tile = document.querySelector(`.tile[data-row="${move.y}"][data-col="${move.x}"]`);
        if (tile) {
            tile.classList.add('highlighted');
        }
    });
}

function updateScoreboard() {
    document.getElementById('next-player-value').textContent = currentPlayer.charAt(0).toUpperCase() + currentPlayer.slice(1);
    document.getElementById('score-gold').textContent = scores.gold;
    document.getElementById('score-green').textContent = scores.green;
    document.getElementById('score-red').textContent = scores.red;
    document.getElementById('score-black').textContent = scores.black;
}

function renderBoard() {
    const gameGrid = document.getElementById('game-grid');
    gameGrid.innerHTML = ''; 

    for (let y = 0; y < 16; y++) {
        for (let x = 0; x < 16; x++) {
            const tile = document.createElement('div');
            tile.classList.add('tile');
            tile.dataset.row = y;
            tile.dataset.col = x;
            
            const cell = board[y][x];

            if (cell && cell.type === 'inactive') {
                tile.classList.add('inactive-tile');
            } else {
                tile.addEventListener('click', () => handleClick(x, y));
                if ((x + y) % 2 === 0) {
                    tile.classList.add('checkered');
                }
                if (cell) {
                    const img = document.createElement('img');
                    img.src = `../assets/${cell.type}_${cell.color}_icon.png`;
                    img.onerror = () => { img.src = `https://placehold.co/18x18/777/FFF?text=${cell.type.charAt(0).toUpperCase()}` };
                    img.alt = 'piece';
                    
                    const pieceDiv = document.createElement('div');
                    pieceDiv.classList.add('piece');
                    pieceDiv.appendChild(img);
                    tile.appendChild(pieceDiv);
                }
            }
            
            gameGrid.appendChild(tile);
        }
    }
    updateScoreboard();
}

// Form submission handler
const form = document.querySelector('form');
form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const avatarname = form.querySelector('[placeholder="YOUR AVATAR NAME"]').value;
    const genderSelf = document.getElementById('option1').checked;
    const genderAI = document.getElementById('option2').checked;
    const genderOthers = document.getElementById('option3').checked;
    const tagline = form.querySelector('[placeholder="TAGLINE: READY FOR WAR"]').value;

    let challenge = '';
    if (genderSelf) challenge = 'self';
    if (genderAI) challenge = 'ai';
    if (genderOthers) challenge = 'others';

    console.log('Form submitted:', { avatarname, challenge, tagline });
    // Add your form submission logic here
});

renderBoard();
    </script>

</body>
</html>
